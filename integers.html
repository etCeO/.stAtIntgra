<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Integer Statistics Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            padding: 30px;
            text-align: center;

            /* Math-style background */
            background-color: #f8fafc;
            background-image:
                linear-gradient(#e3e7eb 1px, transparent 1px),
                linear-gradient(90deg, #e3e7eb 1px, transparent 1px);
            background-size: 40px 40px;
        }    

        h1, h2 {
            color: #333;
            font-weight: 600;
        }

        .box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            margin: 0 auto 30px auto;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            text-align: left;
        }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input,
        textarea,
        button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            font-family: inherit; /* ✅ consistent font */
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }

        textarea {
            resize: vertical;
        }

        button {
            background-color: #0077cc;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            background-color: #005fa3;
        }

        .output {
            margin-top: 15px;
            font-weight: 500;
            font-family: inherit; /* ✅ */
        }

        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }

        table {
            border-collapse: collapse;
            margin: 0 auto;
            font-family: inherit; /* ✅ */
        }

        td {
            border: 1px solid #ccc;
            padding: 10px 14px;
            min-width: 40px;
            text-align: center;
            font-weight: 500;
            background-color: #f9fafb;
        }

        .stat {
            margin-top: 12px;
            font-weight: 500;
        }
        
        /* --- Visualization Styles --- */

        .plot {
            margin-top: 10px;
            padding: 10px;
        }

        .boxplot {
            position: relative;
            height: 60px;
            margin-top: 10px;
        }

        .boxplot-line {
            position: absolute;
            top: 30px;
            left: 0;
            right: 0;
            height: 2px;
            background: #555;
        }

        .boxplot-box {
            position: absolute;
            top: 20px;
            height: 20px;
            background: #cfe8ff;
            border: 2px solid #0077cc;
        }

        .boxplot-marker {
            position: absolute;
            top: 15px;
            width: 2px;
            height: 30px;
            background: #333;
        }

        .boxplot-label {
            position: absolute;
            top: 0;
            transform: translateX(-50%);
            font-size: 12px;
        }

        .bell-curve {
            width: 100%;
            height: 150px;
        }        
    </style>     
    </head>
<body>

<h1>Integer Statistics Calculator</h1>

<div class="box">
    <p>Enter positive integers one at a time.  
       Enter a <strong>negative integer</strong> to finish.</p>

    <input type="number" id="integerInput" placeholder="Enter an integer">
    <button onclick="addInteger()">Submit</button>

    <div class="output" id="output"></div>
</div>

<div class="box">
    <h2>Results</h2>
    <div id="results">No data yet.</div>
</div>

    <div class="box">
        <h2>Send Feedback</h2>
        <form action="https://formspree.io/f/xdalgdgy" method="POST">
            
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" required>
    
            <label for="email">Your Email:</label>
            <input type="email" id="email" name="email" required>
    
            <label for="message">Your Feedback:</label>
            <textarea id="message" name="message" rows="5" required></textarea>
    
            <!-- Optional: Subject Line -->
            <input type="hidden" name="_subject" value="New Feedback from Integer Statistics Calculator">
    
            <button type="submit">Send Feedback</button>
        </form>
    </div>

<script>
    let integersList = [];

    function addInteger() {
        const input = document.getElementById("integerInput");
        const value = parseInt(input.value);
        const output = document.getElementById("output");
        const results = document.getElementById("results");

        if (isNaN(value)) {
            output.textContent = "Invalid input.";
            return;
        }

        if (value < 0) {
            if (integersList.length === 0) {
                results.textContent = "No integers were entered.";
                return;
            }

            const sorted = [...integersList].sort((a, b) => a - b);
            const mean = computeMean(integersList).toFixed(2);
            const stdDev = computeStandardDeviation(integersList).toFixed(2);

            let tableHTML = "<div class='table-container'><table><tr>";
            for (let num of sorted) {
                tableHTML += `<td>${num}</td>`;
            }
            tableHTML += "</tr></table></div>";

            results.innerHTML = `
                <strong>Sorted List:</strong>
                ${tableHTML}

                <div class="stat">
                    <strong>Mean:</strong> ${mean}
                    <div class="plot" id="boxplot"></div>
                </div>

                <div class="stat">
                    <strong>Standard Deviation:</strong> ${stdDev}
                    <div style="margin-top: 20px;">
                        <svg class="bell-curve" id="bellCurve"></svg>
                    </div>
                </div>            `
                ;
            drawBoxPlot(integersList);
            drawBellCurve(mean, stdDev);            
            output.textContent = "Input complete.";
        } else {
            integersList.push(value);
            output.textContent = `Added: ${value}`;
        }

        input.value = "";
        input.focus();
    }

    function computeMean(list) {
        const sum = list.reduce((a, b) => a + b, 0);
        return sum / list.length;
    }

    function computeVariance(list) {
        const mean = computeMean(list);
        let total = 0;

        for (let i of list) {
            total += (i - mean) ** 2;
        }

        return total / list.length;
    }

    function computeStandardDeviation(list) {
        return Math.sqrt(computeVariance(list));
    }

    function drawBoxPlot(data) {
        const container = document.getElementById("boxplot");
        container.innerHTML = "";

        const sorted = [...data].sort((a, b) => a - b);
        const min = sorted[0];
        const max = sorted[sorted.length - 1];
        function quartile(arr, q) {
            const pos = (arr.length - 1) * q;
            const base = Math.floor(pos);
            const rest = pos - base;

            if (arr[base + 1] !== undefined) {
                return arr[base] + rest * (arr[base + 1] - arr[base]);
            } else {
                return arr[base];
            }
        }

        const q1 = quartile(sorted, 0.25);
        const median = quartile(sorted, 0.5);
        const q3 = quartile(sorted, 0.75);
        const scale = val => ((val - min) / (max - min)) * 100;

        container.innerHTML = `
            <div class="boxplot">
                <div class="boxplot-line"></div>

                <div class="boxplot-box"
                    style="left:${scale(q1)}%; width:${scale(q3) - scale(q1)}%;">
                </div>

                ${marker(min, "Min")}
                ${marker(q1, "Q1")}
                ${marker(median, "Median")}
                ${marker(q3, "Q3")}
                ${marker(max, "Max")}
            </div>
        `;

        function marker(value, label) {
            return `
                <div class="boxplot-marker" style="left:${scale(value)}%;"></div>
                <div class="boxplot-label" style="left:${scale(value)}%;">
                    ${label}<br>${parseFloat(value).toFixed(1)}
                </div>
            `;
        }
    }

    function drawBellCurve(mean, stdDev) {
        const svg = document.getElementById("bellCurve");
        svg.innerHTML = "";

        const width = svg.clientWidth;
        const height = svg.clientHeight;

        const μ = parseFloat(mean);
        const σ = parseFloat(stdDev);

        const scaleX = x => ((x + 3) / 6) * width;
        const points = [];

        // Normal curve
        for (let x = -3; x <= 3; x += 0.05) {
            const y = Math.exp(-0.5 * x * x);
            points.push({
                x: scaleX(x),
                y: height - y * height * 0.85
            });
        }

        const linePath = points
            .map((p, i) => `${i === 0 ? "M" : "L"} ${p.x},${p.y}`)
            .join(" ");

        const areaPath = `
            M ${points[0].x},${height}
            ${points.map(p => `L ${p.x},${p.y}`).join(" ")}
            L ${points[points.length - 1].x},${height}
            Z
        `;

        // σ guide lines with numeric labels
        const guides = [
            { x: -2, label: "−2σ", value: (μ - 2 * σ).toFixed(2) },
            { x: -1, label: "−1σ", value: (μ - σ).toFixed(2) },
            { x:  0, label: "μ",   value: μ.toFixed(2) },
            { x:  1, label: "+1σ", value: (μ + σ).toFixed(2) },
            { x:  2, label: "+2σ", value: (μ + 2 * σ).toFixed(2) }
        ];

        const guideLines = guides.map(g => {
            const xPos = scaleX(g.x);
            return `
                <line x1="${xPos}" y1="15" x2="${xPos}" y2="${height - 20}"
                    stroke="#444" stroke-dasharray="4,4" />
                <text x="${xPos}" y="12"
                    text-anchor="middle" font-size="11">
                    ${g.value}
                </text>
                <text x="${xPos}" y="${height - 5}"
                    text-anchor="middle" font-size="11">
                    ${g.label}
                </text>
            `;
        }).join("");

        svg.innerHTML = `
            <path d="${areaPath}" fill="rgba(0,119,204,0.25)"></path>
            <path d="${linePath}" fill="none" stroke="#0077cc" stroke-width="2"></path>

            ${guideLines}

        `;
    }

    const form = document.querySelector("form");
    form.addEventListener("submit", async function(event) {
        event.preventDefault();
        const data = new FormData(form);

        const response = await fetch(form.action, {
            method: form.method,
            body: data,
            headers: { 'Accept': 'application/json' }
        });

        if (response.ok) {
            form.innerHTML = "<p><strong>Thank you! Your feedback has been sent.</strong></p>";
        } else {
            alert("Oops! Something went wrong.");
        }
    });    
</script>

</body>
</html>